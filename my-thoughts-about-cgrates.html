<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title> Thoughts about Cgrates billing system</title>
    <link rel="canonical" href="http://www.acalustra.com/my-thoughts-about-cgrates.html" />
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <meta name="keywords" content=" kamailio, kamevapi, evapi, cgrates, billing"/>
    <meta name="description" content=" Cgrates is a billing platform for kamailio, freeswitch. "/>

    <link rel="stylesheet" type="text/css" href="/theme/css/style.css">
    <link rel="stylesheet" type="text/css" href="/theme/css/pygment.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="http://www.acalustra.com/rss.xml" type="application/atom+xml" rel="alternate" title="A calustra Full Atom Feed" />







    <meta name="tags" content="kamailio, kamevapi, cgrates, billing" />
    <meta name="date" content=" 2015-05-27 21:00:00" />
    <meta name="category" content="blog" />
    <meta name="author" content="Eloy coto" />
    <meta name="robots" content="index,follow" />
  </head>
  <body>
  <div class="wrapper">
    <div class="row nav">
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="archives.html">Blog</a></li>
      </ul>
    </div><!--row nav-->

    <div class="container content">
<div class="row">

  <div id="blog_post" class="blog" itemscope="" itemprop="blogPost" itemtype="http://schema.org/BlogPosting">
    <div class="col-9 col-offset-1">
      <h1 itemprop="name headline">My experience with CGRates</h1>
      <div class="byline">
        Escrito por:
        <span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          <span itemprop="name">
            <a href="https://plus.google.com/106179242242173415236/posts" itemprop="url" rel="author">Eloy Coto Pereiro</a>
          </span>
        </span>
        on
        <time datetime="2015-05-27T21:00:00" itemprop="datePublished">Wednesday May 27th 2015</time>
      </div>

      <div class="content" itemprop="articleBody">
        <p>At <a class="reference external" href="http://www.foehn.co.uk">Foehn</a>, we started to use
<a class="reference external" href="http://cgrates.org/">CGRateS</a> earlier this year, nowadays (May-2015) the
platform has rated tens of millions of calls. I want to share my experience.</p>
<p>I discovered CGRateS in 2014 at the <a class="reference external" href="http://conference.kamailio.com/k03/">Kamailio World
Conference</a>. After a few years using
different solutions we found that CGRateS suits all our needs, so I decided  to
give it a try.</p>
<p>The project is written in <a class="reference external" href="https://golang.org/">Golang</a>, so this was the
first challenge, it's not a bad idea to learn a bit of Golang before installing
CGRateS.</p>
<p>One of our uses is based on <a class="reference external" href="https://cgrates.readthedocs.org/en/latest/cdrclient.html">cdr client</a>, we have some
legacy installations where we wanted to use some CGRateS features. Every few
minutes we send csv files to the platform. This method is fast, we are billing
our daily traffic without problem. On the other hand I tested 10K calls per minute
and it is still fast.</p>
<p>I can recommend this option if you are starting with CGRateS.</p>
<p>In the last weeks, we started working with <a class="reference external" href="https://github.com/cgrates/kamevapi">kamailio
evapi</a> integration. This feature provides
a realtime rating engine in the proxy. This integration is still in test-mode
but I can recommend it well:</p>
<ul class="simple">
<li>Performance in CGRateS is not a problem. We tested with 3K calls per minute in
a t2-small instance. Very good result.</li>
<li>Kamailio configuration with CGRateS <a class="reference external" href="https://github.com/cgrates/cgrates/blob/a2e36b6ae6273a61db2d5e3b2194cd281c105e0e/data/tutorials/kamevapi/kamailio/etc/kamailio/kamailio-cgrates.cfg">is easy</a>.</li>
<li>For every call, CGRateS has a cache map of the current calls, so the timeout
is set based on the virtual balance.</li>
<li>With dialog module you can set the timeouts for these calls.</li>
</ul>
<p>On the other hand, I love the following points:</p>
<div class="section" id="cdrstats">
<h2>CDRStats</h2>
<p><a class="reference external" href="https://github.com/cgrates/cgrates/blob/a2e36b6ae6273a61db2d5e3b2194cd281c105e0e/data/tariffplans/cdrstats/CdrStats.csv">This feature</a>
provides some stats per account, tenant, time frame, call queues, etc.. This is
pretty useful, for example with time frames of 24 hours, you can easily get the
Total Cost of the calls in the last 24 hours per customer. Or the ACC (Average
Call Cost) in the last 1000 calls.</p>
<p>It provides the best interface that I ever seen for fraud, for example:</p>
<ul class="simple">
<li>When TCC in the last 24 hours is more than £XXX</li>
<li>When the ACC in the last 200 calls queue are more than £2</li>
<li>When the ASR(Average success ratio) is less than 20%</li>
</ul>
</div>
<div class="section" id="derivate-charging">
<h2>Derivate Charging:</h2>
<p>In our case we have some rates for customers, this was pretty easy, but we
needed that every call bills three times. One for the cost of the customer, one
for the cost of the reseller, and a one cost with our prices. With 2 lines into
DerivedChargers.csv we can get this easily.</p>
<p>This is pretty useful, nowadays we have a graph with our benefits, costs, and
customer costs in one single panel.</p>
</div>
<div class="section" id="bundles">
<h2>Bundles:</h2>
<p>Bundles are a swiss knife for telecoms. The good thing about CGRates is that
you can have more than one balance per account, moreover you can have two
different balances, <em>monetary</em> or <em>minutes</em>, so you can set a destination
included in a balance in minutes, when this balance finished account will be
switching to monetary balance.</p>
<p>With Acions Triggers you can reset the bundle every first of the month, which
means there are no problems with the recurrent balaces.</p>
<p>With Action Triggers you can call a action when the balance is less than XX
minutes too. It's easy to make business logic based on minutes balances.</p>
</div>
<div class="section" id="api">
<h2>API</h2>
<p>One of the best improvements in the new version(0.9.7) is the fact that the API
is HTTP json-rpc, so it's easy to call to the API from a simple curl request or
any other software like postman.</p>
</div>
<div class="section" id="fixedfees">
<h2>FixedFees</h2>
<p>Another improvement in CGRateS 0.9.7 is the <em>cdrlog</em> action. With this action
you can log into the rated_cdrs table some actions. In this case I'm using it
for the recurrent fees that the customer paid for. Rent of DDIs, number of
extensions or support fees for example.</p>
<p>Finally I need to say, starting with CGRateS it's not easy, but when you have a
little bit of knowledge you can get CGRateS do all the hard billing work for
you.</p>
</div>

      </div>

      <p style="display:none" itemprop="keywords"> billing, cgrates, kamailio,  </p>

        <div class="comments">
          <h4>Commentarios:</h4>
          <div id="disqus_thread"></div>
            <script type="text/javascript" src="http://acalustra.disqus.com/embed.js"></script>
            <noscript><a href="http://acalustra.disqus.com/?url=ref">Ver el hilo de discusión</a></noscript>
        </div> <!-- .comments-container -->

      <div class="row">
        <h4>Artículos relacionados:</h4>
            <ul>
                <li><a href="http://www.acalustra.com/my-review-of-hashiconf-europe-16.html">My review of Hashiconf Europe 16</a></li>
                <li><a href="http://www.acalustra.com/sistemas-de-colas-basado-en-redis-en-kamailio.html">sistemas de colas basado en redis en kamailio</a></li>
                <li><a href="http://www.acalustra.com/kamailio-statsd-better-statistics-in-your-voip-platform.html">Kamailio statsd, better statistics in your voip platform.</a></li>
                <li><a href="http://www.acalustra.com/kamailio-from-tables-to-htables.html">Kamailio from tables to htables</a></li>
                <li><a href="http://www.acalustra.com/how-can-i-monitor-my-voip-application.html">How can I monitor my Voip Application?</a></li>
            </ul>
      </div>


    </div>
    <div class="col-2">
      <h3>Tags</h3>
      <div class="tags">
          <span class="tag">
            <a href="http://www.acalustra.com/tag/billing.html" rel="tag">billing</a>
          </span>
          <span class="tag">
            <a href="http://www.acalustra.com/tag/cgrates.html" rel="tag">cgrates</a>
          </span>
          <span class="tag">
            <a href="http://www.acalustra.com/tag/kamailio.html" rel="tag">kamailio</a>
          </span>
      </div><!--tags-->
      <div class="share">
        <a href="http://twitter.com/share?text=My thoughts about CGRates via @eloycoto&url=http://www.acalustra.com/my-thoughts-about-cgrates.html"><i class="fa fa-twitter"></i></a>
        <br>
        <a href="http://www.facebook.com/sharer/sharer.php?u=http://www.acalustra.com/my-thoughts-about-cgrates.html"><i class="fa fa-facebook"></i></a>
        <br>
        <a target="_blank" href="http://www.linkedin.com/shareArticle?mini=true&url=http://www.acalustra.com/my-thoughts-about-cgrates.html&title=My thoughts about CGRates"><i class="fa fa-linkedin"></i></a>
      </div>
    </div>
  </div>
</div>    </div><!--container-->

    <div class="row footer">
      <div class="container">
        <div class="col-3">
          <p>Eloy Coto</p>
        </div>

        <div class="col-3 col-offset-3">
          <p> Contact: eloy.coto@gmail.com</p>
        </div>

      </div>
    </div>
  </div><!--wrapper-->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-36310774-1', 'auto');
    ga('send', 'pageview');

  </script>
  </body>
</html>